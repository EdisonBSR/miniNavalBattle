<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
      integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <style>
      body {
        display: flex;
        flex-direction: row;
      }
      #container {
        margin: 10px;
        /* border: 1px solid black; */
      }
      #spanPlayer2 {
        text-align: center;
        font-style: oblique;
        color: rgba(222, 48, 48, 0.9);
      }
      #container-Table2 > table {
        margin-top: 90px;
      }
      form {
        display: flex;
        justify-content: center;
      }
      .user {
        background: transparent;
        border: 0px;
        text-align: center;
      }
      .table {
        width: 500px;
        height: 450px;
      }
      .table-bordered td,
      .table-bordered th {
        border: 1px solid #0d86ff;
      }
      .table-bordered td {
        width: 80px;
        height: 80px;
      }
      .boat-position {
        margin: 3px;
        width: 80px;
        height: 80px;
        background: transparent;
        border: 0px;
      }
      .table td,
      .table th {
        padding: 0;
      }
      .table thead th {
        text-align: center;
        background: transparent;
        border-top: 1px solid transparent;
        border-left: 1px solid transparent;
        border-right: 1px solid transparent;
        border-bottom: 0 solid transparent;
      }

      .table th {
        border-top: 1px solid transparent;
        border-left: 1px solid transparent;
        border-bottom: 1px solid transparent;
        text-align: center;
        margin: 0 auto;
      }
      .no-boat {
        background: #9af3ff;
        border-radius: 3px;
        border: none;
      }
      #sendStartGame {
        margin: auto;
        width: 80px;
        padding: 5px;
        margin-left: 20px;
        margin-right: 20px;
        color: #4e4e56;
        text-align: center;
      }
    </style>
    <title>Mini Batalla Naval</title>
  </head>
  <body>
    <div id="container">
      <form id="form-1" action="">
        <input
          id="user-1"
          class="user"
          type="text"
          placeholder="Ingrese su nombre"
          autofocus
        />
        <button type="submit" class="btn btn-success" id="inputName">
          Enviar
        </button>
      </form>
      <span id="spanPlayer1"></span>
      <p>Barcos enemigos localizado <span id="scorePlayer1"></span></p>
      <table class="table table-bordered border-primary">
        <thead>
          <tr>
            <th></th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4</th>
            <th>5</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">A</th>
            <td>
              <button
                class="boat-position"
                id="00"
                type="button"
                value="00"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="01"
                type="button"
                value="01"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="02"
                type="button"
                value="02"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="03"
                type="button"
                value="03"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="04"
                type="button"
                value="04"
                onclick="boatPosition()"
              ></button>
            </td>
          </tr>
          <tr>
            <th scope="row">B</th>
            <td scope="row">
              <button
                class="boat-position"
                id="10"
                type="button"
                value="10"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="11"
                type="button"
                value="11"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="12"
                type="button"
                value="12"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="13"
                type="button"
                value="13"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="14"
                type="button"
                value="14"
                onclick="boatPosition()"
              ></button>
            </td>
          </tr>
          <tr>
            <th scope="row">C</th>
            <td scope="row">
              <button
                class="boat-position"
                id="20"
                type="button"
                value="20"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="21"
                type="button"
                value="21"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="22"
                type="button"
                value="22"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="23"
                type="button"
                value="23"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="24"
                type="button"
                value="24"
                onclick="boatPosition()"
              ></button>
            </td>
          </tr>
          <tr>
            <th scope="row">D</th>
            <td scope="row" name="1">
              <button
                class="boat-position"
                id="30"
                type="button"
                value="30"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="31"
                type="button"
                value="31"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="32"
                type="button"
                value="32"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="33"
                type="button"
                value="33"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="34"
                type="button"
                value="34"
                onclick="boatPosition()"
              ></button>
            </td>
          </tr>
          <tr>
            <th scope="row">E</th>
            <td scope="row">
              <button
                class="boat-position"
                id="40"
                type="button"
                value="40"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="41"
                type="button"
                value="41"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="42"
                type="button"
                value="42"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="43"
                type="button"
                value="43"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="44"
                type="button"
                onclick="boatPosition()"
                value="44"
              ></button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <p id="sendStartGame">Esperando jugador ...</p>
    <div id="container-Table2">
      <span id="spanPlayer2"></span>
      <p><span id="scorePlayer2"></span></p>
      <table class="table table-bordered border-primary">
        <thead>
          <tr>
            <th></th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4</th>
            <th>5</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">A</th>
            <td>
              <button
                class="boat-position"
                id="200"
                type="button"
                value="00"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="201"
                type="button"
                value="01"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="202"
                type="button"
                value="02"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="203"
                type="button"
                value="03"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="204"
                type="button"
                value="04"
                onclick="attack()"
              ></button>
            </td>
          </tr>
          <tr>
            <th scope="row">B</th>
            <td>
              <button
                class="boat-position"
                id="210"
                type="button"
                value="10"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="211"
                type="button"
                value="11"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="212"
                type="button"
                value="12"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="213"
                type="button"
                value="13"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="214"
                type="button"
                value="14"
                onclick="attack()"
              ></button>
            </td>
          </tr>
          <tr>
            <th scope="row">C</th>
            <td>
              <button
                class="boat-position"
                id="220"
                type="button"
                value="20"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="221"
                type="button"
                value="21"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="222"
                type="button"
                value="22"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="223"
                type="button"
                value="23"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="224"
                type="button"
                value="24"
                onclick="attack()"
              ></button>
            </td>
          </tr>
          <tr>
            <th scope="row">D</th>
            <td>
              <button
                class="boat-position"
                id="230"
                type="button"
                value="30"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="231"
                type="button"
                value="31"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="232"
                type="button"
                value="32"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="233"
                type="button"
                value="33"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="234"
                type="button"
                value="34"
                onclick="attack()"
              ></button>
            </td>
          </tr>
          <tr>
            <th scope="row">E</th>
            <td>
              <button
                class="boat-position"
                id="240"
                type="button"
                value="40"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="241"
                type="button"
                value="41"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="242"
                type="button"
                value="42"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="243"
                type="button"
                value="43"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="244"
                type="button"
                onclick="attack()"
                value="44"
              ></button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
      crossorigin="anonymous"
    ></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      let player1 = "";
      let player2 = "";
      let espC = "";
      let playerAtq = "";
      let boardPosition = [];
      let countPosition = 0;
      let score = 0;
      let startShotter = false;
      const ID_BOAT = "bs";
      const FORM1 = document.getElementById("form-1");
      const USER1 = document.getElementById("user-1");
      good = (row, column, user, espS) => {
        if (user == player1) {
          const ID = `2${row}${column}`;
          const BUTTON = document.getElementById(`${ID}`);
          BUTTON.style.background = "#FE2626";
          const BOAT = document.createElement("span");
          BOAT.className += "bi bi-fire";
          BUTTON.appendChild(BOAT);
        } else if (user == player2) {
          const ID = `${row}${column}`;
          const BUTTON = document.getElementById(`${ID}`);
          BUTTON.style.background = "#FE2626";
          const BOAT = document.createElement("span");
          BOAT.className += "bi bi-fire";
          BUTTON.appendChild(BOAT);
        }
      };
      fail = (row, column, user, espS) => {
        if (user == player1) {
          console.log("pinta agua");
          const ID = `2${row}${column}`;
          const BUTTON = document.getElementById(`${ID}`);
          BUTTON.style.background = "#03CAE3";
          const BOAT = document.createElement("span");
          BOAT.className += "bi bi-water";
          BUTTON.appendChild(BOAT);
        } else if (user == player2) {
          console.log("pinta agua");
          const ID = `${row}${column}`;
          const BUTTON = document.getElementById(`${ID}`);
          BUTTON.style.background = "#03CAE3";
          const BOAT = document.createElement("span");
          BOAT.className += "bi bi-water";
          BUTTON.appendChild(BOAT);
        }
      };

      for (let row = 0; row < 5; row++) {
        boardPosition[row] = [];
        for (let column = 0; column < 5; column++) {
          boardPosition[row][column] = 0;
        }
      }
      FORM1.addEventListener("submit", (e) => {
        e.preventDefault();
        const SEND_NAME = document.getElementById("inputName");
        console.log(USER1.value == player2);
        if (USER1.value != "" && USER1.value != player2) {
          player1 = USER1.value;
          USER1.disabled = true;
          SEND_NAME.disabled = true;
          socket.emit("load player", player1);
          console.log(`jugador enviado ${player1}`);
        } else {
          alert("Usuario vacio o el nombre ya esta en uso");
        }
      });
      boatPosition = () => {
        if (countPosition < 5 && player1 != "" && espC == "") {
          let position = event.target.value;
          let x = position.split("");
          let [row, column] = x;
          boardPosition[row][column] = ID_BOAT;
          const ID = event.target.getAttribute("id");
          const BOAT = document.createElement("span");
          BOAT.className += "bi bi-rocket-takeoff";
          const BUTTON = document.getElementById(`${ID}`);
          BUTTON.disabled = true;
          BUTTON.style.background = "#64FB8D";
          BUTTON.appendChild(BOAT);
          countPosition++;
          console.log(countPosition);
        } else if (countPosition >= 6) {
          alert("No puede agregar mas barcos ");
        } else if (player1 == "") {
          alert("No ha ingresado su nombre de jugador");
        }
        if (countPosition == 5) {
          console.log("ingreso a countPosition==5");
          socket.emit("start battle", player1, boardPosition);
          countPosition++;
        }
      };
      socket.on("start battle", (start) => {
        const PLAYER_START_GAME = document.getElementById("sendStartGame");
        startShotter = start;

        if (playerAtq == "") {
          PLAYER_START_GAME.innerText = `Turno de ${player2}`;
          PLAYER_START_GAME.style.color = "green";
        } else {
          PLAYER_START_GAME.innerText = `Turno de ${playerAtq}`;
          PLAYER_START_GAME.style.color = "green";
        }
        if (espC != "") {
          PLAYER_START_GAME.innerText = `Turno de ${player1}`;
          PLAYER_START_GAME.style.color = "green";
        }
      });
      attack = () => {
        if (playerAtq == player1 && startShotter && espC == "") {
          let point = 0;
          let position = event.target.value;
          let x = position.split("");
          let [row, column] = x;
          const ID = event.target.getAttribute("id");
          const BUTTON = document.getElementById(`${ID}`);
          BUTTON.disabled = true;
          socket.emit("attack", player1, point, row, column);
        } else if (espC != "") {
        } else {
          alert("No es tu turno para atacar");
        }
      };
      socket.on("new player", (user1, user2) => {
        if (user1 != "" && user2 != "") {
          alert("usuarios completos");
          espC = "Espectador";
          player1 = user1;
          player2 = user2;
          const SPAN_PLAYER1 = document.getElementById("spanPlayer1");
          const SPAN_PLAYER2 = document.getElementById("spanPlayer2");
          const ENEMY_BOAT = document.getElementById("enemy-boat");
          const SCORE = document.getElementById("scorePlayer1");

          SPAN_PLAYER1.innerText = player1;
          SPAN_PLAYER2.innerText = player2;
          SPAN_PLAYER2.style.color = "black";
          ENEMY_BOAT.innerText = "Gana quie destruya los 5 barcos del rival";
          SCORE.style.color = "transparent";
          socket.emit("load player", espC);
          USER1.disabled = true;
          const SEND_NAME = document.getElementById("inputName");
          SEND_NAME.disabled = true;
          SEND_NAME.style.background = "transparent";
          SEND_NAME.style.border = 0;
          USER1.style.background = "transparent";
          USER1.style.color = "transparent";
          const BUTTON_ALL = document.querySelectorAll("button");
          BUTTON_ALL.disabled = true;
        } else if (user1 != "") {
          player2 = user1;
          const SPAN_PLAYER2 = document.getElementById("spanPlayer2");
          SPAN_PLAYER2.innerHTML = player2;
        }
      });
      socket.on("load player", (user) => {
        if (player2 == "" && player1 != user) {
          player2 = user;
          const SPAN_PLAYER2 = document.getElementById("spanPlayer2");
          SPAN_PLAYER2.innerHTML = user;
          console.log("usuario cargado");
          playerAtq = player1;
        }
      });

      socket.on("attack", (user, point, row, column, espS) => {
        if (user == player1) {
          console.log(`Ingreso ${player1}`);
          if (point == 1) {
            const POINTS_PLAYER1 = document.getElementById("scorePlayer1");
            score += point;
            POINTS_PLAYER1.innerText = `${score}`;
            good(row, column, user, espS);
          } else {
            fail(row, column, user, espS);
          }
          playerAtq = player2;
        } else if (user == player2) {
          console.log(`Ingreso ${player2}`);

          if (point == 1) {
            good(row, column, user);
          } else {
            fail(row, column, user);
          }
          playerAtq = player1;
        }

        if (score == 5) {
          socket.emit("winner", user);
          alert(`GANADOR ¡${user}!`);
          // location.reload();
        }
        const PLAYER_START_GAME = document.getElementById("sendStartGame");
        PLAYER_START_GAME.innerText = `Turno de ${playerAtq}`;
        PLAYER_START_GAME.style.color = "green";
      });
      socket.on("winner", (user) => {
        alert(`GANADOR ¡${user}!`);
        // location.reload();
      });
    </script>
  </body>
</html>
