<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
      integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <style>
      body {
        display: flex;
        flex-direction: row;
      }
      .container {
        margin: 10px;
        border: 1px solid black;
      }
      form {
        display: flex;
        justify-content: center;
      }
      .user {
        background: transparent;
        border: 0px;
        text-align: center;
      }
      .table {
        width: 500px;
        height: 450px;
      }

      .boat-position {
        width: 80px;
        height: 80px;
        /* width: fit-content; */
        background: transparent;
      }
      .boat2-position {
        width: 80px;
        height: 80px;
        /* width: fit-content; */
        background: transparent;
      }
      .no-boat {
        background: #9af3ff;
        border-radius: 3px;
        border: none;
      }
    </style>
    <title>Mini Batalla Naval</title>
  </head>
  <body>
    <div class="container">
      <form id="form-1" action="">
        <input
          id="user-1"
          class="user"
          type="text"
          placeholder="Ingrese su nombre"
          autofocus
        />
        <button type="submit" class="btn btn-success" id="inputName">
          Enviar
        </button>
      </form>
      <table class="table table-borderless">
        <thead>
          <tr>
            <th scope="col">
              Barcos enemigos localizado
              <p id="pointsPlayer1"></p>
              <p id="pointsPlayer2"></p>
              de 5
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td scope="row">
              <button
                class="boat-position"
                id="00"
                type="button"
                value="00"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="01"
                type="button"
                value="01"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="02"
                type="button"
                value="02"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="03"
                type="button"
                value="03"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="04"
                type="button"
                value="04"
                onclick="boatPosition()"
              ></button>
            </td>
          </tr>
          <tr>
            <td scope="row">
              <button
                class="boat-position"
                id="10"
                type="button"
                value="10"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="11"
                type="button"
                value="11"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="12"
                type="button"
                value="12"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="13"
                type="button"
                value="13"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="14"
                type="button"
                value="14"
                onclick="boatPosition()"
              ></button>
            </td>
          </tr>
          <tr>
            <td scope="row">
              <button
                class="boat-position"
                id="20"
                type="button"
                value="20"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="21"
                type="button"
                value="21"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="22"
                type="button"
                value="22"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="23"
                type="button"
                value="23"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="24"
                type="button"
                value="24"
                onclick="boatPosition()"
              ></button>
            </td>
          </tr>
          <tr>
            <td scope="row" name="1">
              <button
                class="boat-position"
                id="30"
                type="button"
                value="30"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="31"
                type="button"
                value="31"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="32"
                type="button"
                value="32"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="33"
                type="button"
                value="33"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="34"
                type="button"
                value="34"
                onclick="boatPosition()"
              ></button>
            </td>
          </tr>
          <tr>
            <td scope="row">
              <button
                class="boat-position"
                id="40"
                type="button"
                value="40"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="41"
                type="button"
                value="41"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="42"
                type="button"
                value="42"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="43"
                type="button"
                value="43"
                onclick="boatPosition()"
              ></button>
            </td>
            <td>
              <button
                class="boat-position"
                id="44"
                type="button"
                onclick="boatPosition()"
                value="44"
              ></button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <p id="sendStartGame">Esperando otro jugador...</p>
    <div class="container">
      <table class="table table-borderless">
        <thead>
          <span id="spanPlayer2"></span>
        </thead>
        <tbody>
          <tr>
            <td scope="row">
              <button
                class="boat2-position"
                id="200"
                type="button"
                value="00"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="201"
                type="button"
                value="01"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="202"
                type="button"
                value="02"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="203"
                type="button"
                value="03"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="204"
                type="button"
                value="04"
                onclick="attack()"
              ></button>
            </td>
          </tr>
          <tr>
            <td scope="row">
              <button
                class="boat2-position"
                id="210"
                type="button"
                value="10"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="211"
                type="button"
                value="11"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="212"
                type="button"
                value="12"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="213"
                type="button"
                value="13"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="214"
                type="button"
                value="14"
                onclick="attack()"
              ></button>
            </td>
          </tr>
          <tr>
            <td scope="row">
              <button
                class="boat2-position"
                id="220"
                type="button"
                value="20"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="221"
                type="button"
                value="21"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="222"
                type="button"
                value="22"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="223"
                type="button"
                value="23"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="224"
                type="button"
                value="24"
                onclick="attack()"
              ></button>
            </td>
          </tr>
          <tr>
            <td scope="row" name="1">
              <button
                class="boat2-position"
                id="230"
                type="button"
                value="30"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="231"
                type="button"
                value="31"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="232"
                type="button"
                value="32"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="233"
                type="button"
                value="33"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="234"
                type="button"
                value="34"
                onclick="attack()"
              ></button>
            </td>
          </tr>
          <tr>
            <td scope="row">
              <button
                class="boat2-position"
                id="240"
                type="button"
                value="40"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="241"
                type="button"
                value="41"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="242"
                type="button"
                value="42"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="243"
                type="button"
                value="43"
                onclick="attack()"
              ></button>
            </td>
            <td>
              <button
                class="boat2-position"
                id="244"
                type="button"
                onclick="attack()"
                value="44"
              ></button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
      crossorigin="anonymous"
    ></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      let player1 = "";
      let player2 = "";
      let playerAtq = "";
      let boardPosition = [];
      let countPosition = 0;
      let enableAttack = true;
      let pointsPlayer1 = 0;
      let pointsPlayer2 = 0;
      const ID_BOAT = "bs";
      const FORM1 = document.getElementById("form-1");
      const USER1 = document.getElementById("user-1");
      const POINTS_PLAYER1 = document.getElementById("pointsPlayer1");
      const POINTS_PLAYER2 = document.getElementById("pointsPlayer2");
      good = (row, column, user) => {
        if (user == player1) {
          ID = `2${row}${column}`;
          BUTTON = document.getElementById(`${ID}`);
          BUTTON.style.background = "#FE2626";
          const BOAT = document.createElement("span");
          BOAT.className += "bi bi-fire";
          BUTTON.appendChild(BOAT);
        } else if (user == player2) {
          ID = `${row}${column}`;
          BUTTON = document.getElementById(`${ID}`);
          BUTTON.style.background = "#FE2626";
          const BOAT = document.createElement("span");
          BOAT.className += "bi bi-fire";
          BUTTON.appendChild(BOAT);
        }
      };
      fail = (row, column, user) => {
        if (user == player1) {
          const ID = `2${row}${column}`;
          BUTTON = document.getElementById(`${ID}`);
          BUTTON.style.background = "#03CAE3";
          const BOAT = document.createElement("span");
          BOAT.className += "bi bi-water";
          BUTTON.appendChild(BOAT);
        } else if (user == player2) {
          const ID = `${row}${column}`;
          BUTTON = document.getElementById(`${ID}`);
          BUTTON.style.background = "#03CAE3";
          const BOAT = document.createElement("span");
          BOAT.className += "bi bi-water";
          BUTTON.appendChild(BOAT);
        }
      };

      for (let row = 0; row < 5; row++) {
        boardPosition[row] = [];
        for (let column = 0; column < 5; column++) {
          boardPosition[row][column] = 0;
        }
      }
      FORM1.addEventListener("submit", (e) => {
        e.preventDefault();
        const SEND_NAME = document.getElementById("inputName");
        if (USER1.value != "" && USER1.value != player2) {
          player1 = USER1.value;
          USER1.disabled = true;
          SEND_NAME.disabled = true;
          socket.emit("load player", player1);
          console.log(`jugador enviado ${player1}`);
        }
        console.log(USER1.value);
        player1 = USER1.value;
      });
      boatPosition = () => {
        if (countPosition < 5 && player1 != "") {
          let position = event.target.value;
          let x = position.split("");
          // console.log(x);
          let [row, column] = x;
          // console.log(`fila ${row} y columna ${column}`);
          boardPosition[row][column] = ID_BOAT;
          // console.log(`fila ${row} - columna ${column}`);
          // console.log(boardPosition[row][column]);
          const ID = event.target.getAttribute("id");
          // console.log(`id del boton para el barco: ${ID}`);
          const BOAT = document.createElement("span");
          BOAT.className += "bi bi-rocket-takeoff";
          const BUTTON = document.getElementById(`${ID}`);
          BUTTON.disabled = true;
          BUTTON.style.background = "#64FB8D";
          BUTTON.appendChild(BOAT);
          countPosition++;
          console.log(countPosition);
        } else {
          alert("No ha ingresado su nombre de jugador");
        }
        if (countPosition == 5) {
          const BUTTO_POSITION =
            document.getElementsByClassName("boat-position");
          BUTTO_POSITION.disabled = true;
          socket.emit("start battle", player1, boardPosition);
        }
      };

      attack = () => {
        if (playerAtq == player1) {
          let point = 0;
          let position = event.target.value;
          let x = position.split("");
          let [row, column] = x;
          // console.log(`funcion attack => fila ${row} y columna ${column}`);
          const ID = event.target.getAttribute("id");
          const BUTTON = document.getElementById(`${ID}`);
          BUTTON.disabled = true;
          // console.log(`juegador 1 ${player1} - jugador 2 ${player2}`);
          socket.emit("attack", player1, point, row, column);
        } else {
          alert("No es tu turno para atacar");
        }
      };
      socket.on("load player", (user) => {
        console.log(player1 != user);
        if (player2 == "" && player1 != user) {
          player2 = user;
          const SPAN_PLAYER2 = document.getElementById("spanPlayer2");
          SPAN_PLAYER2.innerHTML = user;
          console.log("usuario cargado");
          playerAtq = player1;
        }
      });

      socket.on("attack", (user, point, row, column) => {
        console.log(user == player1);
        if (user == player1) {
          if (point == 1) {
            pointsPlayer1 += point;
            POINTS_PLAYER1.innerText = `${pointsPlayer1}`;
            POINTS_PLAYER2.style.color = "transparent";
            good(row, column, user);
          } else {
            fail(row, column, user);
          }
          playerAtq = player2;
        } else if (user == player2) {
          if (point == 1) {
            pointsPlayer2 += point;
            POINTS_PLAYER2.innerText = `${pointsPlayer2}`;
            POINTS_PLAYER1.style.color = "transparent";
            good(row, column, user);
          } else {
            fail(row, column, user);
          }
          playerAtq = player1;
        }
        const BUTTO_START_GAME = document.getElementById("sendStartGame");
        BUTTO_START_GAME.disabled = true;
        BUTTO_START_GAME.innerText = `Turno de ${playerAtq}`;
        BUTTO_START_GAME.style.color = "green";
      });
    </script>
  </body>
</html>
